<!DOCTYPE html>
  <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8" />
      <meta name="author" content="Xu Kuang" />
      <title>数据合并-join函数 | Xu Kuang</title>
      <link rel="shortcut icon" href="/favicon.ico">
      <link href="http://xukuang.github.io/blog/feed/" rel="alternate" title="Xu Kuang" type="application/atom+xml" />
      <link rel="stylesheet" href="/media/css/style.css">
      <link rel="stylesheet" href="/media/css/highlight.css">
      <script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>
      <!--highlight.js Start-->
      <link rel="stylesheet" title="Default" href="/media/js/styles/tomorrow-night-blue.css">
      <script type="text/javascript" src="/media/js/highlight.pack.js"></script>
      <script>
         hljs.configure({tabReplace: '    '});
         hljs.initHighlightingOnLoad();
      </script>
      <!--highlight.js End-->
      <!--mathjax start-->
      <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
      </script>
      <!--mathjax end-->
   </head>
   <script type="text/javascript">
    function setTimeSpan(){
    	var date = new Date();
    	timeSpan.innerText=date.format('yyyy-MM-dd hh:mm:ss');
    }
    
    Date.prototype.format = function(format)
		{
    var o =
    	{
    	    "M+" : this.getMonth()+1, //month
    	    "d+" : this.getDate(),    //day
    	    "h+" : this.getHours(),   //hour
    	    "m+" : this.getMinutes(), //minute
    	    "s+" : this.getSeconds(), //second
    	    "q+" : Math.floor((this.getMonth()+3)/3),  //quarter
    	    "S" : this.getMilliseconds() //millisecond
    	}
    	if(/(y+)/.test(format))
    	format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4 - RegExp.$1.length));
    	for(var k in o)
    	if(new RegExp("("+ k +")").test(format))
    	format = format.replace(RegExp.$1,RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
    	return format;
		}
  </script>
   <body>
     <div id="container">
       <div id="main" role="main">
         <header>
           <h1>数据合并-join函数</h1>
         </header>
         <nav>
           <!-- Sidebar -->
           <h5 id="logo" style="text-align:center;">
             <a href="http://xukuang.github.io/">HOME</a>
		   </h5>
           <span><a title="blog" class="" href="http://xukuang.github.io/blog/">BLOG</a></span>
           <span><a title="about" class="" href="http://xukuang.github.io/blog/about/">ABOUT</a></span>
           <span><a title="categories" class="" href="http://xukuang.github.io/blog/categories/">CATEGORIES</a></span>
           <span><a title="vitae" class="" href="http://xukuang.github.io/blog/vitae/">VITAE</a></span>
           <span><a title="tags" class="" href="http://xukuang.github.io/blog/tags/">TAGS</a></span>
           <span><a title="links" class="" href="http://xukuang.github.io/blog/links/">LINKS</a></span>
           <span><a title="subscribe by RSS" class="" href="http://xukuang.github.io/blog/feed/">SUBSCRIBE</a></span>
	       <!--<ul class="entry-right-list">
            <li class="date">获取每日の能量源</li>
            <li class="qr">
              <img src="http://xukuang.github.io/blog/images/beta.png" width="148" height="148" alt="ATP" style="margin-left: -10px;">
            </li>
           </ul>-->
         </nav>
         <article class="content">
           <section class="post">
<p>前面介绍了数据框合并的merge函数方法，其实还可以借助plyr和dplyr包中的join函数进行数据框的合并，它们数据框合并的原理同样是数据框的合并原理是这样的：首先在x表按指定列每一行的内容在y表的指定列都进行逐行匹配，直到x中所有行匹配完为止。</p>

<h2 id="section">数据说明</h2>
<p>这里的数据仍使用merge函数中的两个数据(略有修改)：作者信息数据和书籍信息数据。依照下面介绍的合并条件，这两个数据既有相同的内容，又有彼此中不存在的内容。</p>

<ul>
  <li>作者信息数据</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>authors &lt;- data.frame(
	id =  c(2, 4, 2, 5, 7, 8, 3),
	surname = I(c("Tukey", "Venables", 'kx', "Tierney", "Ripley", "McNeil", "kuangxu")),
	nationality = c("US", "Australia", 'China', "US", "UK", "Australia", "China"),
	deceased = c("yes", rep("no", 6)))
</code></pre>
</div>
<!--more-->
<p>为了区别数据，就把自己的名字也给安排进去了，唯一的一个中国人啊。</p>

<ul>
  <li>书籍信息数据</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>books &lt;- data.frame(
	id = c(1:7,2)
    name = I(c("Tukey", "Venables", "Tierney",
             "Ripley", "Ripley", "McNeil", "R Core", "kuang")),
    title = c("Exploratory Data Analysis",
              "Modern Applied Statistics ...",
              "LISP-STAT",
              "Spatial Statistics", "Stochastic Simulation",
              "Interactive Data Analysis",
              "An Introduction to R", "My R study"),
    other.author = c(NA, "Ripley", NA, NA, NA, NA,
                     "Venables &amp; Smith", NA))
</code></pre>
</div>

<h2 id="plyrjoin">plyr包的join函数</h2>
<p>join函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>join(x, y, by = NULL, type = 'left', match = 'all')
</code></pre>
</div>

<ul>
  <li>x,y 为合并的数据框</li>
  <li>by 为排序依据，默认值Null时按名字相同的量匹配,此时,要求必须有相同列名的列</li>
  <li>type为合并方式
    <ul>
      <li>inner，行：显示x，y中共有的行; 列：显示x，y中的所有列</li>
      <li>left，行：显示x中所有的行; 列：显示x，y中的所有列，未匹配到的值，不论字符数字，全显示为NA</li>
      <li>right，行：显示y中所有的行; 列：显示x，y中的所有列，未匹配到的值，不论字符数字，全显示为NA</li>
      <li>full，先显示x中所有的行在y中的匹配结果，接着显示y中未匹配上的内容</li>
    </ul>
  </li>
  <li>match匹配的规则
    <ul>
      <li>first，只匹配y中的第一个记录</li>
      <li>match，匹配y中所有记录</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>join(authors, books)
join(authors, books, type = 'left', match = 'first')
join(authors, books, type = 'inner')
join(authors, books, type = 'right')
join(authors, books, type = 'full')
</code></pre>
</div>

<h2 id="dplyrjoin">dplyr包的join函数</h2>
<p>dplyr包是plyr包的升级，join函数在dplyr包中是个系列函数。
join函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>join(x, y, by = NULL, copy = FALSE, ...)
</code></pre>
</div>

<ul>
  <li>x,y 为合并的数据框，不要求x,y中排序列唯一</li>
  <li>by 为排序依据，默认值Null时按名字相同的量匹配,此时,要求必须有相同列名的列</li>
  <li>join为系列函数，包括inner_join、left_join、semi_join和anti_join函数</li>
</ul>

<p>dplyr包的join函数似乎没有plyr包的join函数的match参数，只能进行所谓的all匹配</p>

<h3 id="innerjoin">inner_join函数</h3>
<p>函数结果, 行：显示x中所有能在y中匹配到行; 列：显示x，y中的所有列</p>

<div class="highlighter-rouge"><pre class="highlight"><code>library(dplyr)
# 单指标匹配
inner_join(authors, books)
inner_join(authors, books, by = c('surname' = 'name'))
# 多指标匹配
inner_join(authors, books, by = c('id'='id','surname' = 'name'))
</code></pre>
</div>

<h3 id="leftjoin">left_join函数</h3>

<p>结果, 行：显示x中所有的行; 列：显示x，y中的所有列，未匹配到的值，不论字符数字，全显示为NA。</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 单指标匹配
left_join(authors, books)
left_join(authors, books, by = c('surname' = 'name'))
# 多指标匹配
left_join(authors, books, by = c('id'='id','surname' = 'name'))
</code></pre>
</div>

<h3 id="semijoin">semi_join函数</h3>
<p>结果, 行：显示x中所有能在y匹配到行,并对显示结果按匹配依据进行了排序; 列：显示x中的所有列。
<code class="highlighter-rouge">
# 单指标匹配
semi_join(authors, books)
semi_join(authors, books, by = c('surname' = 'name'))
# 多指标匹配
semi_join(authors, books, by = c('id'='id','surname' = 'name'))
</code></p>

<h3 id="antijoin">anti_join函数</h3>
<p>结果, 行：显示x中所有未能在y中匹配到行, 并对显示结果按匹配依据进行了排序; 列：显示x中的所有列。</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 单指标匹配
anti_join(authors, books)
anti_join(authors, books, by = c('surname' = 'name'))
# 多指标匹配
anti_join(authors, books, by = c('id'='id','surname' = 'name'))
</code></pre>
</div>

<h3 id="fulljoin">full_join函数</h3>
<p>结果, 行：显示x, y中所有的行, 未匹配到的值，不论字符数字，全显示为NA。</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 单指标匹配
full_join(authors, books)
full_join(authors, books, by = c('surname' = 'name'))
# 多指标匹配
full_join(authors, books, by = c('id'='id','surname' = 'name'))
</code></pre>
</div>

</section>
<section class="meta">



<span>
	<a  href="http://xukuang.github.io/blog/2016/01/3dplot/" class="pageNav"  >Previous</a>
	&nbsp;&nbsp;&nbsp;
	<a  href="http://xukuang.github.io/blog/2016/01/melt-and-dcast/" class="pageNav"  >Next</a>
</span>


<span class="author">
  <a href="http://xukuang.github.io/blog">Xu Kuang</a>
</span>
<span class="time">
  /
  <time datetime="2016-01-13">2016-01-13</time>
</span>
<br />
<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
  <a href="http://xukuang.github.io/blog/categories/#技术篇" title="技术篇">技术篇</a>&nbsp;
  
</span>


<span class="tags">
  tagged with 
  
  <a href="http://xukuang.github.io/blog/tags/#R" title="R">R</a>&nbsp;
  
  <a href="http://xukuang.github.io/blog/tags/#数据合并" title="数据合并">数据合并</a>&nbsp;
  
  <a href="http://xukuang.github.io/blog/tags/#plyr" title="plyr">plyr</a>&nbsp;
  
  <a href="http://xukuang.github.io/blog/tags/#dplyr" title="dplyr">dplyr</a>&nbsp;
  
</span>

</section>
<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//httpxukuanggithubio.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://xukuang.github.io/blog/2016/01/3dplot/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://xukuang.github.io/blog/2016/01/melt-and-dcast/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>


         </article>
       </div>
	   
	   
	   <footer>
           <p><small>Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> & <a href="http://pages.github.com">GitHub</a>| Copyright 2012 - 2016 by <a href="/about/">andieguo</a> | <span class="label label-info" id="timeSpan"></span></small></p>
       </footer>
	   
	   
	   </div>
       
	   <script type="text/javascript">
         var _gaq = _gaq || [];
         _gaq.push(['_setAccount', '']);
         _gaq.push(['_trackPageview']);
         (function() {
           var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
           ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
           var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
		
		<!-- Baidu share -->
	<script type="text/javascript">
	window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"32"},"slide":{"type":"slide","bdImg":"0","bdPos":"right","bdTop":"100"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
	</script>

    <!-- Baidu Button BEGIN -->
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?310f86f887042ea3a15786be6e96eb30";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>
	<!-- Baidu Button END -->
	
    </body>
  </html>
                                                    