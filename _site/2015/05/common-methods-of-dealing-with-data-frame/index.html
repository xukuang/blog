<!DOCTYPE html>
  <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
      <meta name="author" content="Xu Kuang" />
        <title>数据框基本操作的常见方法 | Xu Kuang</title>
        <link rel="shortcut icon" href="/favicon.ico">
          <link href="http://xukuang.github.io/blog/feed/" rel="alternate" title="Xu Kuang" type="application/atom+xml" />
            <link rel="stylesheet" href="/media/css/style.css">
              <link rel="stylesheet" href="/media/css/highlight.css">
                <script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>
                  <!--highlight.js Start-->
                  <link rel="stylesheet" title="Default" href="/media/js/styles/tomorrow-night-blue.css">
                    <script type="text/javascript" src="/media/js/highlight.pack.js"></script>
                      <script>
                      hljs.configure({tabReplace: '    '});
                    hljs.initHighlightingOnLoad();
                    </script>
                      <!--highlight.js End-->
                      <!--mathjax start-->
                      <script type="text/javascript"
                      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
                        </script>
                        
                        <!--mathjax end-->
                        </head>
                        <body>
                        <div id="container">
                          <div id="main" role="main">
                            <header>
                            <h1>数据框基本操作的常见方法</h1>
                            </header>
                            <nav>
                            <!-- Sidebar -->
                            <h5 id="logo" style="text-align:center;">
                              <a href="http://xukuang.github.io/">HOME</a></h5>
                                <span><a title="blog" class="" href="http://xukuang.github.io/blog/">BLOG</a></span>
                                  <span><a title="about" class="" href="http://xukuang.github.io/blog/about/">ABOUT</a></span>
                                    <span><a title="categories" class="" href="http://xukuang.github.io/blog/categories/">CATEGORIES</a></span>
                                      <span><a title="vitae" class="" href="http://xukuang.github.io/blog/vitae/">VITAE</a></span>
                                        <span><a title="tags" class="" href="http://xukuang.github.io/blog/tags/">TAGS</a></span>
                                          <span><a title="links" class="" href="http://xukuang.github.io/blog/links/">LINKS</a></span>
                                            <span><a title="subscribe by RSS" class="" href="http://xukuang.github.io/blog/feed/">SUBSCRIBE</a></span>
                                              </nav>
                                              <article class="content">
                                              <section class="post">
<p>本文所说的数据框基本操作，主要包括添加新列、数据排列、数据筛选、数据选择和对所有列进行相同操作，针对每一种操作在基础包和dplyr包中使用方法进行了对比介绍。相对基础包的处理方法，dplyr包中的方法除了更加灵活外，处理速度也会大幅度提升。</p>

<h2 id="section">添加新列</h2>
<p>使用的数据companiesData来自于网络，它是苹果、谷歌以及微软等三家公司在2010到2013年3年间的营收与利润数额，其中fy为年份，company为公司名称，revenue为公司营收，profit为公司利润。创建两列：公司所属国家(country)，其值为America；利润列（margin），其值等于利润(profit)除以营收(revenue)再乘以100。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">fy</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="m">2010</span><span class="p">,</span><span class="m">2011</span><span class="p">,</span><span class="m">2012</span><span class="p">,</span><span class="m">2010</span><span class="p">,</span><span class="m">2011</span><span class="p">,</span><span class="m">2012</span><span class="p">,</span><span class="m">2010</span><span class="p">,</span><span class="m">2011</span><span class="p">,</span><span class="m">2012</span><span class="p">)</span>  
<span class="n">company</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Apple"</span><span class="p">,</span><span class="s2">"Apple"</span><span class="p">,</span><span class="s2">"Apple"</span><span class="p">,</span><span class="s2">"Google"</span><span class="p">,</span><span class="s2">"Google"</span><span class="p">,</span><span class="s2">"Google"</span><span class="p">,</span><span class="s2">"Microsoft"</span><span class="p">,</span>  
<span class="s2">"Microsoft"</span><span class="p">,</span><span class="s2">"Microsoft"</span><span class="p">)</span>  
<span class="n">revenue</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="m">65225</span><span class="p">,</span><span class="m">108249</span><span class="p">,</span><span class="m">156508</span><span class="p">,</span><span class="m">29321</span><span class="p">,</span><span class="m">37905</span><span class="p">,</span><span class="m">50175</span><span class="p">,</span><span class="m">62484</span><span class="p">,</span><span class="m">69943</span><span class="p">,</span><span class="m">73723</span><span class="p">)</span>  
<span class="n">profit</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="m">14013</span><span class="p">,</span><span class="m">25922</span><span class="p">,</span><span class="m">41733</span><span class="p">,</span><span class="m">8505</span><span class="p">,</span><span class="m">9737</span><span class="p">,</span><span class="m">10737</span><span class="p">,</span><span class="m">18760</span><span class="p">,</span><span class="m">23150</span><span class="p">,</span><span class="m">16978</span><span class="p">)</span>  
<span class="n">companiesData</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">fy</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="n">profit</span><span class="p">)</span>
</code></pre>
</div>
<!--more-->

<ul>
  <li>为列简单创建一个变量名称</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">companiesData</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">fy</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="n">profit</span><span class="p">)</span>
<span class="n">companiesData</span><span class="o">$</span><span class="n">country</span> <span class="o">&lt;-</span> <span class="s1">'America'</span>
<span class="n">companiesData</span><span class="o">$</span><span class="n">margin</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">companiesData</span><span class="o">$</span><span class="n">profit</span> <span class="o">/</span> <span class="n">companiesData</span><span class="o">$</span><span class="n">revenue</span><span class="p">)</span> <span class="o">*</span> <span class="m">100</span>
<span class="n">companiesData</span>
		<span class="n">fy</span>   <span class="n">company</span> <span class="n">revenue</span> <span class="n">profit</span> <span class="n">country</span>   <span class="n">margin</span>
	<span class="m">1</span> <span class="m">2010</span>     <span class="n">Apple</span>   <span class="m">65225</span>  <span class="m">14013</span>  <span class="n">Aerica</span> <span class="m">21.48409</span>
	<span class="m">2</span> <span class="m">2011</span>     <span class="n">Apple</span>  <span class="m">108249</span>  <span class="m">25922</span>  <span class="n">Aerica</span> <span class="m">23.94664</span>
	<span class="m">3</span> <span class="m">2012</span>     <span class="n">Apple</span>  <span class="m">156508</span>  <span class="m">41733</span>  <span class="n">Aerica</span> <span class="m">26.66509</span>
	<span class="m">4</span> <span class="m">2010</span>    <span class="n">Google</span>   <span class="m">29321</span>   <span class="m">8505</span>  <span class="n">Aerica</span> <span class="m">29.00651</span>
	<span class="m">5</span> <span class="m">2011</span>    <span class="n">Google</span>   <span class="m">37905</span>   <span class="m">9737</span>  <span class="n">Aerica</span> <span class="m">25.68790</span>
	<span class="m">6</span> <span class="m">2012</span>    <span class="n">Google</span>   <span class="m">50175</span>  <span class="m">10737</span>  <span class="n">Aerica</span> <span class="m">21.39910</span>
	<span class="m">7</span> <span class="m">2010</span> <span class="n">Microsoft</span>   <span class="m">62484</span>  <span class="m">18760</span>  <span class="n">Aerica</span> <span class="m">30.02369</span>
	<span class="m">8</span> <span class="m">2011</span> <span class="n">Microsoft</span>   <span class="m">69943</span>  <span class="m">23150</span>  <span class="n">Aerica</span> <span class="m">33.09838</span>
	<span class="m">9</span> <span class="m">2012</span> <span class="n">Microsoft</span>   <span class="m">73723</span>  <span class="m">16978</span>  <span class="n">Aerica</span> <span class="m">23.02945</span>
</code></pre>
</div>

<ul>
  <li>利用transform函数</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">companiesData</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">fy</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="n">profit</span><span class="p">)</span>
<span class="n">companiesData</span> <span class="o">&lt;-</span> <span class="n">transform</span><span class="p">(</span><span class="n">companiesData</span><span class="p">,</span>  <span class="n">country</span> <span class="o">=</span> <span class="s1">'Aerica'</span><span class="p">,</span> <span class="n">margin</span> <span class="o">=</span> <span class="p">(</span><span class="n">profit</span><span class="o">/</span><span class="n">revenue</span><span class="p">)</span> <span class="o">*</span> <span class="m">100</span><span class="p">)</span>
<span class="n">companiesData</span>
		<span class="n">fy</span>   <span class="n">company</span> <span class="n">revenue</span> <span class="n">profit</span> <span class="n">country</span>   <span class="n">margin</span>
	<span class="m">1</span> <span class="m">2010</span>     <span class="n">Apple</span>   <span class="m">65225</span>  <span class="m">14013</span>  <span class="n">Aerica</span> <span class="m">21.48409</span>
	<span class="m">2</span> <span class="m">2011</span>     <span class="n">Apple</span>  <span class="m">108249</span>  <span class="m">25922</span>  <span class="n">Aerica</span> <span class="m">23.94664</span>
	<span class="m">3</span> <span class="m">2012</span>     <span class="n">Apple</span>  <span class="m">156508</span>  <span class="m">41733</span>  <span class="n">Aerica</span> <span class="m">26.66509</span>
	<span class="m">4</span> <span class="m">2010</span>    <span class="n">Google</span>   <span class="m">29321</span>   <span class="m">8505</span>  <span class="n">Aerica</span> <span class="m">29.00651</span>
	<span class="m">5</span> <span class="m">2011</span>    <span class="n">Google</span>   <span class="m">37905</span>   <span class="m">9737</span>  <span class="n">Aerica</span> <span class="m">25.68790</span>
	<span class="m">6</span> <span class="m">2012</span>    <span class="n">Google</span>   <span class="m">50175</span>  <span class="m">10737</span>  <span class="n">Aerica</span> <span class="m">21.39910</span>
	<span class="m">7</span> <span class="m">2010</span> <span class="n">Microsoft</span>   <span class="m">62484</span>  <span class="m">18760</span>  <span class="n">Aerica</span> <span class="m">30.02369</span>
	<span class="m">8</span> <span class="m">2011</span> <span class="n">Microsoft</span>   <span class="m">69943</span>  <span class="m">23150</span>  <span class="n">Aerica</span> <span class="m">33.09838</span>
	<span class="m">9</span> <span class="m">2012</span> <span class="n">Microsoft</span>   <span class="m">73723</span>  <span class="m">16978</span>  <span class="n">Aerica</span> <span class="m">23.02945</span>
</code></pre>
</div>

<p>相对第一种方法，transform可以同时添加多列，书写相对简单，但是利用tranform时，新列必须是原始列的计算，而不能对刚刚建立起来的列进行计算，换句话说上面的第二条语句，如果要写成这样是错误的：companiesData &lt;- transform(companiesData,  country = ‘Aerica’, margin = (profit/revenue) * 100, margin.new = margin * 1.2),原因就在于margin.new = margin * 1.2中margin是新生的数据列，而非数据中原有的列。</p>

<ul>
  <li>dplyr包中的mutate函数</li>
</ul>

<p>dplyr包可以简单地认为是对plyr包的升级，所以这两个包中的mutate函数有相似的作用。mutate函数很好的解决了transform函数不能解决的问题，即mutate函数，允许新列对刚刚建立起来的列进行计算。所以，对于tansform函数来说，错误的companiesData &lt;- transform(companiesData,  country = ‘Aerica’, margin = (profit/revenue) * 100, margin.new = margin * 1.2)，对于mutate函数来说，companiesData &lt;- mutate(companiesData,  country = ‘Aerica’, margin = (profit/revenue) * 100, margin.new = margin * 1.2)是正确的。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="n">companiesData</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">fy</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">revenue</span><span class="p">,</span> <span class="n">profit</span><span class="p">)</span>
<span class="n">companiesData</span> <span class="o">&lt;-</span> <span class="n">mutate</span><span class="p">(</span><span class="n">companiesData</span><span class="p">,</span> <span class="n">country</span> <span class="o">=</span> <span class="s1">'Aerica'</span><span class="p">,</span> <span class="n">margin</span> <span class="o">=</span> <span class="p">(</span><span class="n">profit</span><span class="o">/</span><span class="n">revenue</span><span class="p">)</span> <span class="o">*</span> <span class="m">100</span><span class="p">,</span> <span class="n">margin.new</span> <span class="o">=</span> <span class="n">margin</span> <span class="o">*</span> <span class="m">1.2</span><span class="p">)</span>
<span class="n">companiesData</span>
		<span class="n">fy</span>   <span class="n">company</span> <span class="n">revenue</span> <span class="n">profit</span> <span class="n">country</span>   <span class="n">margin</span> <span class="n">margin.new</span>
	<span class="m">1</span> <span class="m">2010</span>     <span class="n">Apple</span>   <span class="m">65225</span>  <span class="m">14013</span>  <span class="n">Aerica</span> <span class="m">21.48409</span>   <span class="m">25.78091</span>
	<span class="m">2</span> <span class="m">2011</span>     <span class="n">Apple</span>  <span class="m">108249</span>  <span class="m">25922</span>  <span class="n">Aerica</span> <span class="m">23.94664</span>   <span class="m">28.73597</span>
	<span class="m">3</span> <span class="m">2012</span>     <span class="n">Apple</span>  <span class="m">156508</span>  <span class="m">41733</span>  <span class="n">Aerica</span> <span class="m">26.66509</span>   <span class="m">31.99811</span>
	<span class="m">4</span> <span class="m">2010</span>    <span class="n">Google</span>   <span class="m">29321</span>   <span class="m">8505</span>  <span class="n">Aerica</span> <span class="m">29.00651</span>   <span class="m">34.80782</span>
	<span class="m">5</span> <span class="m">2011</span>    <span class="n">Google</span>   <span class="m">37905</span>   <span class="m">9737</span>  <span class="n">Aerica</span> <span class="m">25.68790</span>   <span class="m">30.82548</span>
	<span class="m">6</span> <span class="m">2012</span>    <span class="n">Google</span>   <span class="m">50175</span>  <span class="m">10737</span>  <span class="n">Aerica</span> <span class="m">21.39910</span>   <span class="m">25.67892</span>
	<span class="m">7</span> <span class="m">2010</span> <span class="n">Microsoft</span>   <span class="m">62484</span>  <span class="m">18760</span>  <span class="n">Aerica</span> <span class="m">30.02369</span>   <span class="m">36.02842</span>
	<span class="m">8</span> <span class="m">2011</span> <span class="n">Microsoft</span>   <span class="m">69943</span>  <span class="m">23150</span>  <span class="n">Aerica</span> <span class="m">33.09838</span>   <span class="m">39.71806</span>
	<span class="m">9</span> <span class="m">2012</span> <span class="n">Microsoft</span>   <span class="m">73723</span>  <span class="m">16978</span>  <span class="n">Aerica</span> <span class="m">23.02945</span>   <span class="m">27.63534</span>
</code></pre>
</div>

<h2 id="section-1">数据排列</h2>
<p>数据hflights来自R包hflights，记录的是飞机航班数据信息。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>library(hflights) 
</code></pre>
</div>

<ul>
  <li>利用order函数</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># 默认升序排列
hf = hflights[order(hflights$DayofMonth, hflights$Month, hflights$Year), ]
# 降序排列
hflights[order(desc(hflights$ArrDelay)), ]
</code></pre>
</div>

<ul>
  <li>dplyr包中的arrange函数</li>
</ul>

<p>plyr包中也有具有相似功能arrange函数</p>

<div class="highlighter-rouge"><pre class="highlight"><code>require(dplyr)
# 默认升序排列
hf = arrange(hflights, DayofMonth, Month, Year)
# 对列名加 desc() 进行倒序
hf = arrange(hflights, desc(ArrDelay))
</code></pre>
</div>

<h2 id="section-2">数据筛选</h2>

<p>数据同样使用自R包hflights的hflights。数据筛选是选择满足符合某些条件的数据行。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># 查看各月数据行，方便下面的结果的确认
</span><span class="n">table</span><span class="p">(</span><span class="n">hlihgts</span><span class="o">$</span><span class="n">Month</span><span class="p">)</span>
		<span class="m">1</span>     <span class="m">2</span>     <span class="m">3</span>     <span class="m">4</span>     <span class="m">5</span>     <span class="m">6</span>     <span class="m">7</span>     <span class="m">8</span>     <span class="m">9</span>    <span class="m">10</span>    <span class="m">11</span>    <span class="m">12</span> 
	<span class="m">18910</span> <span class="m">17128</span> <span class="m">19470</span> <span class="m">18593</span> <span class="m">19172</span> <span class="m">19600</span> <span class="m">20548</span> <span class="m">20176</span> <span class="m">18065</span> <span class="m">18696</span> <span class="m">18021</span> <span class="m">19117</span> 
</code></pre>
</div>

<ul>
  <li>
    <p>直接选取数据框中满足条件的数据行</p>

    <ul>
      <li>满足一个条件</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">## 满足数据框hflights中Month列等于1
</span><span class="n">hf1</span> <span class="o">=</span> <span class="n">hflights</span><span class="p">[</span><span class="n">hflights</span><span class="o">$</span><span class="n">Month</span> <span class="o">==</span> <span class="m">1</span><span class="p">]</span>
<span class="n">nrow</span><span class="p">(</span><span class="n">hf1</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">18910</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>* 两个以上的条件：同时满足(相当于逻辑“且”)
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># 这里以两个条件为例
## 例子1：满足数据框hflights中Month列同时等于1和2
</span><span class="n">hf2</span> <span class="o">=</span> <span class="n">hflights</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">hflights</span><span class="o">$</span><span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">&amp;</span> <span class="n">hflights</span><span class="o">$</span><span class="n">Month</span> <span class="o">==</span> <span class="m">2</span><span class="p">),</span> <span class="p">]</span>
<span class="c1">## 其值等于0，数据框hflights的Month列没有同时等于1，又等于2的数据行
</span><span class="n">nrow</span><span class="p">(</span><span class="n">hf2</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">0</span>
<span class="c1">## 例子2：满足数据框hflights中Month列等于1且DayofMonth列等于2
</span><span class="n">hf3</span> <span class="o">=</span> <span class="n">hflights</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">hflights</span><span class="o">$</span><span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">&amp;</span> <span class="n">hflights</span><span class="o">$</span><span class="n">DayofMonth</span> <span class="o">==</span> <span class="m">2</span><span class="p">),</span> <span class="p">]</span>
<span class="n">nrow</span><span class="p">(</span><span class="n">hf3</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">678</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>* 两个以上的条件：至少满足其中一个(相当于逻辑“或”)
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># 这里以两个条件为例
## 例子1：满足数据框hflights中Month列同时等于1或2
</span><span class="n">hf4</span> <span class="o">=</span> <span class="n">hflights</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">hflights</span><span class="o">$</span><span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">|</span> <span class="n">hflights</span><span class="o">$</span><span class="n">Month</span> <span class="o">==</span> <span class="m">2</span><span class="p">),</span> <span class="p">]</span>
<span class="c1">## 其值等于18910(Month = 1) + 17128(Month = 1)
</span><span class="n">nrow</span><span class="p">(</span><span class="n">hf4</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">36038</span>
<span class="c1">## 例子2：满足数据框hflights中Month列等于1或DayofMonth列等于2
</span><span class="n">hf5</span> <span class="o">=</span> <span class="n">hflights</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="n">hflights</span><span class="o">$</span><span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">|</span> <span class="n">hflights</span><span class="o">$</span><span class="n">DayofMonth</span> <span class="o">==</span> <span class="m">2</span><span class="p">),</span> <span class="p">]</span>
<span class="n">nrow</span><span class="p">(</span><span class="n">hf5</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">25764</span>
</code></pre>
</div>

<ul>
  <li>
    <p>subset函数</p>

    <ul>
      <li>满足一个条件</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">## 满足数据框hflights中Month列等于1
</span><span class="n">hf1</span> <span class="o">=</span> <span class="n">subset</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span><span class="p">)</span>
<span class="n">nrow</span><span class="p">(</span><span class="n">hf1</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">18910</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>* 两个以上的条件：同时满足(相当于逻辑“且”)
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># 这里以两个条件为例
## 例子1：满足数据框hflights中Month列同时等于1和2
</span><span class="n">hf2</span> <span class="o">=</span> <span class="n">subset</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">&amp;</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="c1">## 其值等于0，数据框hflights的Month列没有同时等于1，又等于2的数据行
</span><span class="n">nrow</span><span class="p">(</span><span class="n">hf2</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">0</span>
<span class="c1">## 例子2：满足数据框hflights中Month列等于1且DayofMonth列等于2
</span><span class="n">hf3</span> <span class="o">=</span> <span class="n">subset</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">&amp;</span> <span class="n">DayofMonth</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="n">nrow</span><span class="p">(</span><span class="n">hf3</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">678</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>* 两个以上的条件：至少满足其中一个(相当于逻辑“或”)
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># 这里以两个条件为例
## 例子1：满足数据框hflights中Month列同时等于1或2
</span><span class="n">hf4</span> <span class="o">=</span> <span class="n">subset</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">|</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="c1">## 此时也只有此时，subset函数可以写多个条件
## 这种方法不建议使用
</span><span class="n">hf4</span> <span class="o">=</span> <span class="n">subset</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="c1">## 其值等于18910(Month = 1) + 17128(Month = 1)
</span><span class="n">nrow</span><span class="p">(</span><span class="n">hf4</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">36038</span>
<span class="c1">## 例子2：满足数据框hflights中Month列等于1或DayofMonth列等于2
</span><span class="n">hf5</span> <span class="o">=</span> <span class="n">subset</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">|</span> <span class="n">DayofMonth</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="n">nrow</span><span class="p">(</span><span class="n">hf5</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">25764</span>
</code></pre>
</div>

<ul>
  <li>dplyr包中的fliter函数</li>
</ul>

<p>plyr包中并没有相似功能的filter函数</p>

<div class="highlighter-rouge"><pre class="highlight"><code>* 满足一个条件
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">require</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="c1">## 满足数据框hflights中Month列等于1
</span><span class="n">hf1</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span><span class="p">)</span>
<span class="n">nrow</span><span class="p">(</span><span class="n">hf1</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">18910</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>* 两个以上的条件：同时满足(相当于逻辑“且”)
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># 这里以两个条件为例
## 例子1：满足数据框hflights中Month列同时等于1和2
</span><span class="n">hf2</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">&amp;</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="c1">##在filter中,','直接相当于'&amp;'
</span><span class="n">hf2</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="c1">## 为了统一，这种方法也不推荐使用
## 其值等于0，数据框hflights的Month列没有同时等于1，又等于2的数据行
</span><span class="n">nrow</span><span class="p">(</span><span class="n">hf2</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">0</span>
<span class="c1">## 例子2：满足数据框hflights中Month列等于1且DayofMonth列等于2
</span><span class="n">hf3</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">&amp;</span> <span class="n">DayofMonth</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="c1">## 在filter中,','直接相当于'&amp;'
## 为了统一，这种方法也不推荐使用
</span><span class="n">hf3</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span><span class="p">,</span> <span class="n">DayofMonth</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="n">nrow</span><span class="p">(</span><span class="n">hf3</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">678</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>* 两个以上的条件：至少满足其中一个(相当于逻辑“或”)
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># 这里以两个条件为例
## 例子1：满足数据框hflights中Month列同时等于1或2
</span><span class="n">hf4</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">|</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="c1">## 其值等于18910(Month = 1) + 17128(Month = 1)
</span><span class="n">nrow</span><span class="p">(</span><span class="n">hf4</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">36038</span>
<span class="c1">## 例子2：满足数据框hflights中Month列等于1或DayofMonth列等于2
</span><span class="n">hf5</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">hflights</span><span class="p">,</span> <span class="n">Month</span> <span class="o">==</span> <span class="m">1</span> <span class="o">|</span> <span class="n">DayofMonth</span> <span class="o">==</span> <span class="m">2</span><span class="p">)</span>
<span class="n">nrow</span><span class="p">(</span><span class="n">hf5</span><span class="p">)</span>
	<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">25764</span>
</code></pre>
</div>

<h2 id="section-3">数据选择</h2>

<p>数据选择是选择数据框中的制定的列，这里使用的数据是dplyr包中自带的iris函数。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span>
	  <span class="n">Sepal.Length</span> <span class="n">Sepal.Width</span> <span class="n">Petal.Length</span> <span class="n">Petal.Width</span> <span class="n">Species</span>
	<span class="m">1</span>          <span class="m">5.1</span>         <span class="m">3.5</span>          <span class="m">1.4</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">2</span>          <span class="m">4.9</span>         <span class="m">3.0</span>          <span class="m">1.4</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">3</span>          <span class="m">4.7</span>         <span class="m">3.2</span>          <span class="m">1.3</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">4</span>          <span class="m">4.6</span>         <span class="m">3.1</span>          <span class="m">1.5</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">5</span>          <span class="m">5.0</span>         <span class="m">3.6</span>          <span class="m">1.4</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">6</span>          <span class="m">5.4</span>         <span class="m">3.9</span>          <span class="m">1.7</span>         <span class="m">0.4</span>  <span class="n">setosa</span>
</code></pre>
</div>

<ul>
  <li>
    <p>直接选取</p>

    <ul>
      <li>利用字符向量选取指定列</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iris.part1</span> <span class="o">=</span> <span class="n">iris</span><span class="p">[,</span><span class="n">c</span><span class="p">(</span><span class="s1">'Sepal.Length'</span><span class="p">,</span> <span class="s1">'Sepal.Width'</span><span class="p">)]</span>
<span class="n">head</span><span class="p">(</span><span class="n">iris.part1</span><span class="p">)</span>
	  <span class="n">Sepal.Length</span> <span class="n">Sepal.Width</span>
	<span class="m">1</span>          <span class="m">5.1</span>         <span class="m">3.5</span>
	<span class="m">2</span>          <span class="m">4.9</span>         <span class="m">3.0</span>
	<span class="m">3</span>          <span class="m">4.7</span>         <span class="m">3.2</span>
	<span class="m">4</span>          <span class="m">4.6</span>         <span class="m">3.1</span>
	<span class="m">5</span>          <span class="m">5.0</span>         <span class="m">3.6</span>
	<span class="m">6</span>          <span class="m">5.4</span>         <span class="m">3.9</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>* 利用数字向量选择指定列
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># 利用":"选取相邻列
</span><span class="n">iris.part2</span> <span class="o">=</span> <span class="n">iris</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]</span>
<span class="n">head</span><span class="p">(</span><span class="n">iris.part2</span><span class="p">)</span>
	  <span class="n">Sepal.Length</span> <span class="n">Sepal.Width</span>
	<span class="m">1</span>          <span class="m">5.1</span>         <span class="m">3.5</span>
	<span class="m">2</span>          <span class="m">4.9</span>         <span class="m">3.0</span>
	<span class="m">3</span>          <span class="m">4.7</span>         <span class="m">3.2</span>
	<span class="m">4</span>          <span class="m">4.6</span>         <span class="m">3.1</span>
	<span class="m">5</span>          <span class="m">5.0</span>         <span class="m">3.6</span>
	<span class="m">6</span>          <span class="m">5.4</span>         <span class="m">3.9</span>
<span class="c1"># 利用一般数字向量选取相邻列
</span><span class="n">iris.part3</span> <span class="o">=</span> <span class="n">iris</span><span class="p">[,</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">)]</span>
<span class="n">head</span><span class="p">(</span><span class="n">iris.part3</span><span class="p">)</span>
	  <span class="n">Sepal.Length</span> <span class="n">Petal.Length</span> <span class="n">Petal.Width</span>
	<span class="m">1</span>          <span class="m">5.1</span>          <span class="m">1.4</span>         <span class="m">0.2</span>
	<span class="m">2</span>          <span class="m">4.9</span>          <span class="m">1.4</span>         <span class="m">0.2</span>
	<span class="m">3</span>          <span class="m">4.7</span>          <span class="m">1.3</span>         <span class="m">0.2</span>
	<span class="m">4</span>          <span class="m">4.6</span>          <span class="m">1.5</span>         <span class="m">0.2</span>
	<span class="m">5</span>          <span class="m">5.0</span>          <span class="m">1.4</span>         <span class="m">0.2</span>
	<span class="m">6</span>          <span class="m">5.4</span>          <span class="m">1.7</span>         <span class="m">0.4</span>

</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>* 利用“-”结合数字向量排除数据框的某些列
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iris.part4</span> <span class="o">=</span> <span class="n">iris</span><span class="p">[,</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)]</span>
<span class="n">head</span><span class="p">(</span><span class="n">iris.part4</span><span class="p">)</span>
	  <span class="n">Petal.Length</span> <span class="n">Petal.Width</span> <span class="n">Species</span>
	<span class="m">1</span>          <span class="m">1.4</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">2</span>          <span class="m">1.4</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">3</span>          <span class="m">1.3</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">4</span>          <span class="m">1.5</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">5</span>          <span class="m">1.4</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">6</span>          <span class="m">1.7</span>         <span class="m">0.4</span>  <span class="n">setosa</span>
<span class="n">iris.part5</span> <span class="o">=</span> <span class="n">iris</span><span class="p">[,</span><span class="o">-</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">)]</span>
<span class="n">head</span><span class="p">(</span><span class="n">iris.part5</span><span class="p">)</span>
	  <span class="n">Sepal.Width</span> <span class="n">Species</span>
	<span class="m">1</span>         <span class="m">3.5</span>  <span class="n">setosa</span>
	<span class="m">2</span>         <span class="m">3.0</span>  <span class="n">setosa</span>
	<span class="m">3</span>         <span class="m">3.2</span>  <span class="n">setosa</span>
	<span class="m">4</span>         <span class="m">3.1</span>  <span class="n">setosa</span>
	<span class="m">5</span>         <span class="m">3.6</span>  <span class="n">setosa</span>
	<span class="m">6</span>         <span class="m">3.9</span>  <span class="n">setosa</span>
</code></pre>
</div>

<ul>
  <li>利用dplyr包中的select函数</li>
</ul>

<p>select函数能完成上部分基础函数的所有操作。plyr包中也没有相似功能的select函数</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># 利用列名选取指定列
</span><span class="n">iris.part1</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span> <span class="n">Sepal.Length</span><span class="p">,</span> <span class="n">Sepal.Width</span><span class="p">)</span>
<span class="c1"># 甚至可以对选取的列进行重命名
</span><span class="n">iris.part1</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span> <span class="n">Sepal_length</span> <span class="o">=</span> <span class="n">Sepal.Length</span><span class="p">,</span> <span class="n">Sepal_Width</span> <span class="o">=</span> <span class="n">Sepal.Width</span><span class="p">)</span>
<span class="n">head</span><span class="p">(</span><span class="n">iris.part1</span><span class="p">)</span>
	  <span class="n">Sepal_length</span> <span class="n">Sepal_Width</span>
	<span class="m">1</span>          <span class="m">5.1</span>         <span class="m">3.5</span>
	<span class="m">2</span>          <span class="m">4.9</span>         <span class="m">3.0</span>
	<span class="m">3</span>          <span class="m">4.7</span>         <span class="m">3.2</span>
	<span class="m">4</span>          <span class="m">4.6</span>         <span class="m">3.1</span>
	<span class="m">5</span>          <span class="m">5.0</span>         <span class="m">3.6</span>
	<span class="m">6</span>          <span class="m">5.4</span>         <span class="m">3.9</span>
<span class="c1"># 利用数字向量选择指定列
</span><span class="n">iris.part2</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
<span class="n">iris.part3</span> <span class="o">=</span> <span class="n">iris</span><span class="p">[,</span> <span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">)]</span>
<span class="c1"># * 利用"-"结合数字向量排除数据框的某些列 
</span><span class="n">iris.part4</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">))</span>
<span class="n">iris.part5</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span>
</code></pre>
</div>

<p>select函数还有自己的特点：</p>

<ul>
  <li>”:”支持相邻列名的选取</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iris.part6</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="n">Sepal.Length</span><span class="o">:</span><span class="n">Petal.Length</span><span class="p">)</span>
<span class="n">head</span><span class="p">(</span><span class="n">iris.part6</span><span class="p">)</span>
	  <span class="n">Sepal.Length</span> <span class="n">Sepal.Width</span> <span class="n">Petal.Length</span>
	<span class="m">1</span>          <span class="m">5.1</span>         <span class="m">3.5</span>          <span class="m">1.4</span>
	<span class="m">2</span>          <span class="m">4.9</span>         <span class="m">3.0</span>          <span class="m">1.4</span>
	<span class="m">3</span>          <span class="m">4.7</span>         <span class="m">3.2</span>          <span class="m">1.3</span>
	<span class="m">4</span>          <span class="m">4.6</span>         <span class="m">3.1</span>          <span class="m">1.5</span>
	<span class="m">5</span>          <span class="m">5.0</span>         <span class="m">3.6</span>          <span class="m">1.4</span>
	<span class="m">6</span>          <span class="m">5.4</span>         <span class="m">3.9</span>          <span class="m">1.7</span>
</code></pre>
</div>

<ul>
  <li>支持某些特定语法格式</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># 以"Petal"开始的列
head(select(iris, starts_with("Petal")))
	  Petal.Length Petal.Width
	1          1.4         0.2
	2          1.4         0.2
	3          1.3         0.2
	4          1.5         0.2
	5          1.4         0.2
	6          1.7         0.4
# 以"Width"结尾的列
head(select(iris, ends_with("Width")))
	  Sepal.Width Petal.Width
	1         3.5         0.2
	2         3.0         0.2
	3         3.2         0.2
	4         3.1         0.2
	5         3.6         0.2
	6         3.9         0.4
# 包含"etal"的列
head(select(iris, contains("etal")))
	  Petal.Length Petal.Width
	1          1.4         0.2
	2          1.4         0.2
	3          1.3         0.2
	4          1.5         0.2
	5          1.4         0.2
	6          1.7         0.4
# 甚至可以对上述个操作用"-"
select(iris, -starts_with("Petal"))
select(iris, -ends_with("Width"))
select(iris, -contains("etal"))
select(iris, -Petal.Length, -Petal.Width)
</code></pre>
</div>

<ul>
  <li>“-”去除指定列</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iris.part7</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="n">Sepal.Length</span><span class="o">:</span><span class="n">Petal.Length</span><span class="p">))</span>
<span class="n">head</span><span class="p">(</span><span class="n">iris.part7</span><span class="p">)</span>
	  <span class="n">Petal.Width</span> <span class="n">Species</span>
	<span class="m">1</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">2</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">3</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">4</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">5</span>         <span class="m">0.2</span>  <span class="n">setosa</span>
	<span class="m">6</span>         <span class="m">0.4</span>  <span class="n">setosa</span>
</code></pre>
</div>
<p>这里，主要讲述的是结合“:”的使用方法。其实正如上个例子那样，”-“也可与特定的语法格式结合使用。</p>

<h2 id="section-4">对所有列进行相同操作</h2>

<p>这里的操作主要指求和、平均值、方差、标准、最小值、最大值以及简单的四则运算。</p>

<ul>
  <li>colSums和colMeans
基础包里的colSums和colMeans函数，只能对所有列进行求和和求平均值操作，并且要求所有数据列必须是数字型的, 否则会提示错误。</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>library(hflights)
head(hflights)

# 提取数字类型列
hflights.dat = hflights[,! colnames(hflights) %in% c('CancellationCode', 'UniqueCarrier', 'TailNum', 'Origin', 'Dest')]
head(hflights.dat)
summary(hflights.dat)
colSums(hflights.dat, na.rm = T)
colMeans(hflights.dat, na.rm = T)
</code></pre>
</div>

<ul>
  <li>
    <p>dplyr包的summarise_each或者mutate_each</p>

    <ul>
      <li>summarise_each可以进行求平均值、标准差、方差、最小值和最大值，此时被处理的数据列也不需要必须是数字类型(只是此时会有警告提示)。然而，无论如何要进行求和操作时，所有数据列必须是数字类型(原因是sum函数对字符求和，直接返回错误，而求平均值、标准差和方差只是返回NA，并提示警告，最小值和最大值时返回真实的结果)。当然也可以多个指标同时计算。</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># 平均值，字符平均值返回NA
summarise_each(hflights, funs(mean))
# 标准差，字符标准差返回NA
summarise_each(hflights, funs(sd))
# 方差，字符方差返回NA
summarise_each(hflights, funs(var))
# 最小值，字符最小值也是可以运算的
summarise_each(hflights, funs(min))
# 最大值，字符最大值也是可以运算的
summarise_each(hflights, funs(max))
# 平均值、最小值和最大值
summarise_each(hflights, funs(mean, min, max))

# 求和
hflights.dat = hflights[,! colnames(hflights) %in% c('CancellationCode', 'UniqueCarrier', 'TailNum', 'Origin', 'Dest')]
summarise_each(hflights.dat, funs(sum))

# 若果某一列中有NA，要想得到结果可以通过调整函数内部的na.rm参数来实现
# 平均值
summarise_each(hflights, funs(mean(., na.rm = T)))
# 标准差
summarise_each(hflights, funs(sd(., na.rm = T)))
# 方差
summarise_each(hflights, funs(var(., na.rm = T)))
# 最小值
summarise_each(hflights, funs(min(., na.rm = T)))
# 最大值
summarise_each(hflights, funs(max(., na.rm = T)))
# 求和
summarise_each(hflights.dat, funs(sum(., na.rm = T)))
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>* mutate_each跟summarise_each最大的不同在于产生于原数据相同行数的结果，所以mutate_each除了可以进行summarise_each函数的操作以外，还可进行简单四则运算，当然进行四则运算时，要保证所有列都是数字型。	
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code># 四则运算
temp1 = mutate_each(hflights.dat, funs( . + 1))
head(hflights)
head(temp1)
# 事实上四则运算根本不需要借助函数来实现
temp2 = hflights.dat + 1
</code></pre>
</div>

<ul>
  <li>plyr包的colwise函数</li>
</ul>

<p>plyr包的colwise函数也能对数据框的所有列进行相同的操作。同样可以直接进行求平均值、标准差、方差、最小值和最大值，此时被处理的数据列也不需要必须是数字类型(只是此时会有警告提示)。当所有数据列都是数字类型可以直接求和。当然也可以多个指标同时计算。</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 平均值，字符平均值返回NA
colwise(mean)(hflights)
# 标准差，字符标准差返回NA
colwise(sd)(hflights)
# 方差，字符方差返回NA
colwise(var)(hflights)
# 最小值，字符最小值也是可以运算的
colwise(min)(hflights)
# 最大值，字符最大值也是可以运算的
colwise(max)(hflights)
# 平均值、最小值和最大值
colwise(mean, min, max)(hflights)

# 求和
hflights.dat = hflights[,! colnames(hflights) %in% c('CancellationCode', 'UniqueCarrier', 'TailNum', 'Origin', 'Dest')]
colwise(sum)(hflights)

# 若果某一列中有NA，要想得到结果可以通过调整函数内部的na.rm参数来实现
# 平均值
colwise(function(x)mean(x, na.rm = T))(hflights)
# 标准差
colwise(function(x)sd(x, na.rm = T))(hflights)
# 方差
colwise(function(x)var(x, na.rm = T))(hflights)
# 最小值
colwise(function(x)min(x, na.rm = T))(hflights)
# 最大值
colwise(function(x)max(x, na.rm = T))(hflights)
# 求和
colwise(function(x)sum(x, na.rm = T))(hflights.dat)

temp3 = colwise(function(x){x + 1})(hflights.dat)
head(hflights)
head(temp3)
# 事实上四则运算根本不需要借助函数来实现
temp2 = hflights.dat + 1
</code></pre>
</div>

</section>
<section class="meta">



<span>
	<a  href="http://xukuang.github.io/blog/2015/05/contolling-axes-of-R-plots/" class="pageNav"  >Previous</a>
	&nbsp;&nbsp;&nbsp;
	<a  href="http://xukuang.github.io/blog/2015/05/daqingxiangguo/" class="pageNav"  >Next</a>
</span>


<span class="author">
  <a href="http://xukuang.github.io/blog">Xu Kuang</a>
</span>
<span class="time">
  /
  <time datetime="2015-05-16">2015-05-16</time>
</span>
<br />
<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
  <a href="http://xukuang.github.io/blog/categories/#技术篇" title="技术篇">技术篇</a>&nbsp;
  
</span>


<span class="tags">
  tagged with 
  
  <a href="http://xukuang.github.io/blog/tags/#R" title="R">R</a>&nbsp;
  
  <a href="http://xukuang.github.io/blog/tags/#dplyr" title="dplyr">dplyr</a>&nbsp;
  
</span>

</section>
<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//httpxukuanggithubio.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://xukuang.github.io/blog/2015/05/contolling-axes-of-R-plots/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://xukuang.github.io/blog/2015/05/daqingxiangguo/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>


                                              </article>
                                                </div>
                                                </div>
                                                <script type="text/javascript">
                                                  var _gaq = _gaq || [];
                                                  _gaq.push(['_setAccount', '']);
                                                  _gaq.push(['_trackPageview']);
                                                  (function() {
                                                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                                                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                                                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                                                  })();
                                                  </script>
                                                    </body>
                                                    </html>
                                                    